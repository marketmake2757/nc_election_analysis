---
title: "nc_election_analysis"
output: word_document
date: "2025-11-24"
---

```{r}

#load libraries

library(dplyr)
library(rio)
library(tidyr)
library(car)

#load data sets

import("nc_county_demographics.csv")->countydemographics

import("results_pct_20241105.txt")->results

#filter out all races except president
pres_results <- results %>%
  filter(`Contest Name` == "US PRESIDENT")
  
#Create a single row for each county and columns for each candidates vote share  
  
county_results <- pres_results %>%
  group_by(County, `Choice`) %>%           # candidate column
  summarise(
    total_votes = sum(`Total Votes`, na.rm = TRUE),    # votes column
    .groups = "drop"
  ) %>%
  pivot_wider(
    names_from = `Choice`,
    values_from = total_votes,
    values_fill = 0                             # fill missing with 0
  )
  
  
#Create total votes and percentage of vote for each candidate columns  
  
numeric_cols <- names(county_results)[sapply(county_results, is.numeric)]
numeric_cols



candidate_cols <- c(
  "Chase Oliver",
  "Claudia De la Cruz (Write-In)",
  "Cornel West",
  "Donald J. Trump",
  "Jill Stein",
  "Kamala D. Harris",
  "Randall Terry",
  "Shiva Ayyadurai (Write-In)",
  "Write-In (Miscellaneous)"
)


county_results <- county_results %>%
  mutate(
    # 1) total votes across candidate columns
    total_votes = rowSums(across(all_of(candidate_cols))),
    
    # 2) percent each candidate got (0â€“1 scale)
    across(
      all_of(candidate_cols),
      ~ .x / total_votes,
      .names = "{.col}_pct"
    )
  )
  
#merge data sets and create turnout percetnage column

  county_results_demographics <- county_results %>%
  left_join(countydemographics, by = c("County" = "county"))
  
county_results_demographics <- county_results_demographics %>%
  mutate(total = as.numeric(gsub(",", "", total)))


county_results_demographics <- county_results_demographics %>%
  mutate(
    turnout_percentage = total_votes / total
  )
  
#Run regression model and avPlots

lm (`Donald J. Trump_pct` ~ percent_republican + turnout_percentage, data=county_results_demographics)  -> regmodel

avPlots(regmodel)

```